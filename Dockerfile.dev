FROM node:20-alpine

WORKDIR /usr/src/app

COPY package.json yarn.lock ./

RUN yarn install

COPY . .

ARG PORT=8000
ARG NODE_ENV=dev
ARG CLIENT_BASE_URL=http://localhost:5173
ARG DATABASE_HOST=127.0.0.1
ARG DATABASE_PORT=5432
ARG DATABASE_USER=postgres
ARG DATABASE_PASSWORD=1234
ARG DATABASE_NAME=jiru
ARG DATABASE_URL=postgresql://postgres:1234@127.0.0.1:5432/jiru
ARG JWT_ACCESS_SECRET=secret1
ARG JWT_WS_SECRET=secret1
ARG JWT_REFRESH_SECRET=secret2
ARG JWT_PASSWORD_RESET_SECRET=secret3
ARG REDIS_PORT=6379
ARG REDIS_PASSWORD=redis_secret
ARG REDIS_HOST=localhost

ENV PORT=${PORT}
ENV NODE_ENV=${NODE_ENV}
ENV CLIENT_BASE_URL=${CLIENT_BASE_URL}
ENV DATABASE_HOST=${DATABASE_HOST}
ENV DATABASE_PORT=${DATABASE_PORT}
ENV DATABASE_USER=${DATABASE_USER}
ENV DATABASE_PASSWORD=${DATABASE_PASSWORD}
ENV DATABASE_NAME=${DATABASE_NAME}
ENV DATABASE_URL=${DATABASE_URL}
ENV JWT_ACCESS_SECRET=${JWT_ACCESS_SECRET}
ENV JWT_WS_SECRET=${JWT_WS_SECRET}
ENV JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET}
ENV JWT_PASSWORD_RESET_SECRET=${JWT_PASSWORD_RESET_SECRET}
ENV REDIS_PORT=${REDIS_PORT}
ENV REDIS_PASSWORD=${REDIS_PASSWORD}
ENV REDIS_HOST=${REDIS_HOST}

EXPOSE 8000

CMD ["yarn", "dev"]